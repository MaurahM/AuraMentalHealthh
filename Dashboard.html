<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Dashboard | Aura</title>

<style>
  :root {
    --bg: #3b1534;
    --panel: #5a2450;
    --card: #6f3b64;
    --accent: #ff2fa6;
    --muted: #d9c9dc;
    --white: #ffffff;
  }

  html, body {
    height: 100%;
    margin: 0;
    font-family: Inter, system-ui, Segoe UI, Roboto, "Helvetica Neue", Arial;
    background: var(--bg);
    color: var(--white);
    overflow-x: hidden;
  }

  /* Main wrap */
  .wrap {
    min-height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 36px;
    box-sizing: border-box;
    position: relative;
  }

  .panel {
    width: 100%;
    max-width: 1100px;
    background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
    border-radius: 20px;
    padding: 40px;
    box-shadow: 0 20px 50px rgba(0,0,0,0.45);
    box-sizing: border-box;
    position: relative;
    border: 1px solid rgba(255,255,255,0.05);
  }

  /* Header */
  .header {
    text-align: center;
    margin-bottom: 30px;
  }

  .greet {
    font-size: 32px;
    font-weight: 700;
    letter-spacing: 0.4px;
    margin: 0;
    background: linear-gradient(to right, #ffffff, var(--muted));
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  /* Grid cards */
  .grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 22px;
    max-width: 820px;
    margin: 20px auto 0;
  }

  .card {
    background: linear-gradient(145deg, rgba(255,255,255,0.05), rgba(255,255,255,0.01));
    border-radius: 20px;
    padding: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    gap: 16px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.2);
    border: 1px solid rgba(255,255,255,0.08);
    cursor: pointer;
    transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  }

  .card:hover {
    transform: translateY(-8px) scale(1.02);
    background: rgba(255,255,255,0.07);
    border-color: var(--accent);
    box-shadow: 0 15px 35px rgba(255, 47, 166, 0.2);
  }

  .oval {
    width: 80px;
    height: 80px;
    border-radius: 22px;
    display: flex;
    align-items: center;    justify-content: center;
    background: rgba(255,255,255,0.03);
    transition: 0.3s ease;
  }

  .card:hover .oval {
    background: var(--accent);
  }

  .icon {
    width: 38px;
    height: 38px;
    fill: var(--accent);
    transition: 0.3s ease;
  }

  .card:hover .icon {
    fill: white;
  }

  .label {
    font-size: 17px;
    font-weight: 600;
    color: var(--white);
  }

  /* Panel actions */
  .panel-actions {
    display: flex;
    justify-content: center;
    gap: 15px;
    margin-top: 35px;
    flex-wrap: wrap;
  }

  .btn-ghost {
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--muted);
    padding: 10px 20px;
    border-radius: 12px;
    text-decoration: none;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    transition: 0.2s ease;
    display: flex;
    align-items: center;
    gap: 8px;
  }

  .btn-ghost:hover {
    background: rgba(255, 47, 166, 0.15);
    color: white;
    border-color: var(--accent);
  }

  /* Theme dropdown */
  .theme-dropdown {
    position: absolute;
    top: 25px;
    right: 25px;
  }

  .theme-toggle {
    padding: 8px 16px;
    background: var(--card);
    color: var(--white);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    cursor: pointer;
    font-size: 13px;
  }

  .theme-box {
    background: var(--panel);
    padding: 12px;
    border-radius: 12px;
    position: absolute;
    top: 45px;
    right: 0;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    z-index: 100;
    border: 1px solid rgba(255,255,255,0.1);
  }

  .hidden { display: none; }

  .theme-buttons { display: flex; gap: 10px; }

  .theme-btn {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    border: 2px solid rgba(255,255,255,0.2);
    cursor: pointer;
  }

  .theme-btn.pink { background: #ff2fa6; }
  .theme-btn.blue { background: #4dc3ff; }
  .theme-btn.green { background: #8aff80; }

  @media (max-width:820px){
    .grid { grid-template-columns: 1fr; }
    .panel { padding: 25px; }
    .greet { font-size: 24px; }
  }

</style>
</head>
<body>

<script>
(async function() {
  const token = localStorage.getItem('convai_user_token');
  
  // 1. If no token, they aren't logged in at all
  if (!token) {
    window.location.href = 'index.html';
    return;
  }

  try {
    // 2. IMPORTANT: Verify actual subscription status from the DB
    // Replace URL with your actual hosted backend URL
    const response = await fetch('http://localhost:5000/api/auth/verify-status', {
      method: 'GET',
      headers: { 
        'Authorization': `Bearer ${token}`,
        'Content-Type': 'application/json'
      }
    });

    const data = await response.json();

    if (!data.isPaid) {
      // If server says they haven't paid, clear local status and boot them
      localStorage.setItem('aura_paid_status', 'false');
      window.location.href = 'subscribe.html';
    } else {
      // Store expiry date for the Profile page
      localStorage.setItem('aura_expiry', data.subscriptionExpiry);
    }
  } catch (err) {
    console.log("Offline mode: Using cached status.");
    if (localStorage.getItem('aura_paid_status') !== 'true') {
      window.location.href = 'subscribe.html';
    }
  }
})();
</script>

<main class="wrap">
  <section class="panel">
    <header class="header">
      <h1 id="dashTitle" class="greet">Loading...</h1>
    </header>

    <div class="theme-dropdown">
      <button class="theme-toggle">âœ¨ Appearance</button>
      <div class="theme-box hidden">
        <div class="theme-buttons">
          <button class="theme-btn pink" onclick="applyTheme('pink')"></button>
          <button class="theme-btn blue" onclick="applyTheme('blue')"></button>
          <button class="theme-btn green" onclick="applyTheme('green')"></button>
        </div>
      </div>
    </div>

    <div class="grid">
      <div class="card" data-target="Chat.html">
        <div class="oval"><svg class="icon" viewBox="0 0 24 24"><path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2z"/></svg></div>
        <div class="label">Chat with Aura</div>
      </div>

      <div class="card" data-target="Journal.html">
        <div class="oval"><svg class="icon" viewBox="0 0 24 24"><path d="M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zM6 4h5v8l-2.5-1.5L6 12V4z"/></svg></div>
        <div class="label">Journal</div>
      </div>

      <div class="card" data-target="meditation.html">
        <div class="oval"><svg class="icon" viewBox="0 0 24 24"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg></div>
        <div class="label">Meditation</div>
      </div>

      <div class="card" data-target="affirmationsdashboard.html">
        <div class="oval"><svg class="icon" viewBox="0 0 24 24"><path d="M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10-4.477 10-10 10zm0-2a8 8 0 1 0 0-16 8 8 0 0 0 0 16zM11 7h2v2h-2V7zm0 4h2v6h-2v-6z"/></svg></div>
        <div class="label">Affirmations</div>
      </div>
    </div>

    <div class="panel-actions">
      <a class="btn-ghost" href="Escalation.html">ðŸš¨ Emergency</a>
      <a class="btn-ghost" href="ProfileSettings.html">ðŸ‘¤ Profile</a>
      <button class="btn-ghost" id="logout-button">âžœ Log Out</button>
    </div>
  </section>
</main>

<script src="theme-manager.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Theme Toggle UI
  const themeToggleBtn = document.querySelector('.theme-toggle');
  const themeBox = document.querySelector('.theme-box');
  themeToggleBtn.addEventListener('click', () => themeBox.classList.toggle('hidden'));

  // Card Navigation
  document.querySelectorAll('.card').forEach(card => {
    card.addEventListener('click', () => {
      window.location.href = card.dataset.target;
    });
  });

  // Logout Logic
  const logoutButton = document.getElementById('logout-button');
  if (logoutButton) {
    logoutButton.addEventListener('click', () => {
      localStorage.clear(); // Clears token and payment status
      window.location.href = 'index.html';
    });
  }

  // Personal Greeting Logic
  function updateGreeting() {
    const hour = new Date().getHours();
    const userName = localStorage.getItem('convai_user_name') || "Friend"; 
    const dashTitle = document.getElementById('dashTitle');
    
    let greet = "Hello";
    let emoji = "ðŸ‘‹";

    if (hour < 12) { greet = "Good morning"; emoji = "ðŸŒ…"; }
    else if (hour < 17) { greet = "Good afternoon"; emoji = "ðŸŒž"; }
    else if (hour < 21) { greet = "Good evening"; emoji = "ðŸŒ‡"; }
    else { greet = "Good night"; emoji = "ðŸŒ™"; }

    dashTitle.textContent = `${greet}, ${userName} ${emoji}`;
  }

  updateGreeting();
});
</script>
</body>
</html>