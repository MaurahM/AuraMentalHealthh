<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Aura â€” Settings</title>
<style>
  :root {
    --bg: #2e0f27; /* Darker deep plum */
    --accent: #ff2fa6;
    --accent-glow: rgba(255, 47, 166, 0.3);
    --muted: #bdaaba;
    --white: #ffffff;
    --glass: rgba(255, 255, 255, 0.03);
    --input-bg: rgba(0, 0, 0, 0.25);
  }

  * { box-sizing: border-box; transition: all 0.2s ease-in-out; }
  
  html, body { 
    height: 100%; margin: 0; 
    font-family: 'Inter', system-ui, -apple-system, sans-serif; 
    background: var(--bg); color: var(--white);
    background-image: radial-gradient(circle at top right, rgba(255, 47, 166, 0.08), transparent 400px);
  }

  .wrap { min-height: 100%; display: flex; align-items: center; justify-content: center; padding: 40px 20px; }

  .panel { 
    width: 100%; max-width: 850px; 
    background: var(--glass); 
    backdrop-filter: blur(15px);
    border-radius: 24px; padding: 40px; 
    box-shadow: 0 40px 80px rgba(0, 0, 0, 0.6);
    border: 1px solid rgba(255, 255, 255, 0.08);
  }

  h1 { font-size: 32px; font-weight: 800; margin: 0 0 10px; letter-spacing: -0.5px; }
  .lead { color: var(--muted); margin-bottom: 30px; font-size: 15px; }

  /* --- INPUT STYLING --- */
  label { display: block; font-size: 12px; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; color: var(--muted); }
  
  input[type="text"], input[type="email"], input[type="number"], input[type="time"], select, textarea {
    width: 100%; padding: 14px 18px; border-radius: 14px; border: 1px solid rgba(255, 255, 255, 0.1);
    background: var(--input-bg); color: white; font-size: 15px; outline: none;
    box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
  }

  input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 4px var(--accent-glow); }

  /* --- ACCORDIONS --- */
  .settings-group {
    background: rgba(255, 255, 255, 0.02); border-radius: 18px; margin-bottom: 16px;
    border: 1px solid rgba(255, 255, 255, 0.05); overflow: hidden;
  }

  summary {
    padding: 24px; cursor: pointer; list-style: none; display: flex; align-items: center; justify-content: space-between;
  }

  summary h2 { font-size: 18px; margin: 0; font-weight: 700; color: #fff; }
  summary .summary-text { font-size: 13px; color: var(--muted); margin-top: 4px; }

  summary::after {
    content: '+'; font-size: 24px; color: var(--accent); font-weight: 300;
  }
  .settings-group[open] summary::after { content: 'âˆ’'; }

  .content-body { padding: 0 24px 24px; }

  /* --- GRID & ROW --- */
  .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 15px; }
  .row { display: flex; gap: 12px; align-items: center; }

  /* --- CHIPS --- */
  .chip {
    flex: 1; display: flex; align-items: center; justify-content: center; gap: 8px;
    background: var(--input-bg); padding: 12px; border-radius: 12px;
    cursor: pointer; border: 1px solid transparent; font-size: 14px; font-weight: 600;
  }
  .chip:hover { background: rgba(255, 255, 255, 0.08); }
  .chip input { accent-color: var(--accent); margin: 0; }

  /* --- AVATAR --- */
  .avatar-wrap { display: flex; flex-direction: column; align-items: center; gap: 15px; padding: 20px; }
  .avatar {
    width: 110px; height: 110px; border-radius: 50%;
    background: linear-gradient(45deg, var(--accent), #7b2ffb);
    display: flex; align-items: center; justify-content: center;
    border: 4px solid rgba(255, 255, 255, 0.1);
    box-shadow: 0 10px 30px rgba(0,0,0,0.3); overflow: hidden;
  }
  .avatar img { width: 100%; height: 100%; object-fit: cover; }

  /* --- BUTTONS --- */
  .btn {
    background: linear-gradient(90deg, var(--accent), #ff5aa8); color: #fff;
    border: 0; padding: 14px 28px; border-radius: 999px; cursor: pointer;
    font-weight: 700; font-size: 15px; box-shadow: 0 10px 25px var(--accent-glow);
  }
  .btn:hover { transform: translateY(-2px); box-shadow: 0 15px 30px var(--accent-glow); }
  
  .btn-ghost {
    background: transparent; border: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--muted); padding: 12px 20px; border-radius: 12px; cursor: pointer;
  }
  .btn-ghost:hover { background: rgba(255, 255, 255, 0.05); color: white; }

  /* --- TRUSTED LIST --- */
  .trusted-item {
    background: rgba(0,0,0,0.2); padding: 12px 16px; border-radius: 14px;
    display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;
    border: 1px solid rgba(255, 255, 255, 0.03);
  }

  @media (max-width: 700px) { .grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>

  <main class="wrap">
    <section class="panel">
      <h1>Account Settings</h1>
      <p class="lead">Personalize your Aura experience and manage your data.</p>

      <form id="settingsForm">
        
        <details open class="settings-group">
          <summary>
            <div>
              <h2>Profile & Preferences</h2>
              <p class="summary-text">Your identity and how Aura talks to you.</p>
            </div>
          </summary>
          <div class="content-body">
            <div class="grid">
              <div class="input-group">
                <label for="fullName">Display Name</label>
                <input id="fullName" name="fullName" type="text" placeholder="Alex Smith" />
              </div>
              <div class="input-group">
                <label for="language">Language Style</label>
                <select id="language" name="language">
                  <option value="en">English (Standard)</option>
                  <option value="en-kenya">Kenyan English</option>
                  <option value="sw">Swahili</option>
                  <option value="mix">English + Swahili</option>
                </select>
              </div>
            </div>
            <div class="grid" style="margin-top:20px">
               <div class="input-group">
                <label for="affirmTime">Daily Affirmation</label>
                <input id="affirmTime" type="time" />
              </div>
              <div class="input-group">
                <label>Theme Color</label>
                <div class="row">
                   <div style="width:30px; height:30px; border-radius:50%; background:var(--accent); border:2px solid white;"></div>
                   <span class="summary-text">Aura Pink (Default)</span>
                </div>
              </div>
            </div>
          </div>
        </details>

        <details class="settings-group">
          <summary>
            <div>
              <h2>Wellness & Privacy</h2>
              <p class="summary-text">Manage mood tracking and conversation history.</p>
            </div>
          </summary>
          <div class="content-body">
            <label>Mood Tracking Frequency</label>
            <div class="row" style="margin-bottom:20px">
              <label class="chip"><input type="radio" name="moodFreq" value="daily" /> Daily</label>
              <label class="chip"><input type="radio" name="moodFreq" value="weekly" /> Weekly</label>
              <label class="chip"><input type="radio" name="moodFreq" value="" /> Off</label>
            </div>

            <label>Privacy Controls</label>
            <div class="trusted-item">
              <div>
                <span style="display:block; font-weight:600">Save Chat History</span>
                <span class="summary-text">Used to improve AI empathy over time.</span>
              </div>
              <input type="checkbox" id="saveHistory" style="width:20px; height:20px; accent-color:var(--accent)">
            </div>
          </div>
        </details>

        <details class="settings-group">
          <summary>
            <div>
              <h2>Emergency Support</h2>
              <p class="summary-text">Manage contacts for crisis escalation.</p>
            </div>
          </summary>
          <div class="content-body">
            <div class="grid">
              <input id="trustedName" placeholder="Contact Name" type="text" />
              <input id="trustedPhone" placeholder="+254..." type="text" />
            </div>
            <button type="button" id="addTrusted" class="btn-ghost" style="width:100%; margin-top:10px">+ Add Contact</button>
            
            <div id="trustedList" style="margin-top:20px">
              </div>
          </div>
        </details>

        <details class="settings-group">
          <summary>
            <div>
              <h2>Security & Photo</h2>
              <p class="summary-text">Update your look and biometric settings.</p>
            </div>
          </summary>
          <div class="content-body">
            <div class="grid" style="align-items: center;">
              <div class="avatar-wrap">
                <div class="avatar" id="avatarPreview">
                  <svg width="40" height="40" viewBox="0 0 24 24" fill="white" opacity="0.5"><path d="M12 12a4 4 0 1 0 0-8 4 4 0 0 0 0 8z"/><path d="M4 20a8 8 0 0 1 16 0"/></svg>
                </div>
                <label for="avatarInput" style="cursor:pointer; color:var(--accent)">Upload Photo</label>
                <input id="avatarInput" type="file" accept="image/*" style="display:none" />
              </div>
              <div class="input-group">
                 <div class="trusted-item">
                   <span class="summary-text">FaceID / Fingerprint</span>
                   <input type="checkbox" id="biometric" style="accent-color:var(--accent)">
                 </div>
              </div>
            </div>
          </div>
        </details>

        <div style="display:flex; justify-content: space-between; align-items: center; margin-top: 30px;">
          <button type="button" id="resetBtn" class="btn-ghost">Reset All</button>
          <button type="submit" class="btn">Save All Changes</button>
        </div>
      </form>
    </section>
  </main>


<script>
// Your existing JavaScript functions and initialization logic go here.
// NOTE: You will need to update the `loadTrusted`, `saveTrusted`, and `renderTrusted` 
// functions to correctly update the new `trustedCount` element.

Â  const KEY = 'convai_profile_v1';
Â  const form = document.getElementById('settingsForm');
Â  const stress = document.getElementById('stress');
Â  const stressVal = document.getElementById('stressVal');
Â  const avatarInput = document.getElementById('avatarInput');
Â  const avatarPreview = document.getElementById('avatarPreview');
Â  const addTrusted = document.getElementById('addTrusted');
Â  const trustedName = document.getElementById('trustedName');
Â  const trustedPhone = document.getElementById('trustedPhone');
Â  const trustedListEl = document.getElementById('trustedList');
Â  const trustedCount = document.getElementById('trustedCount');

Â  function load() {
Â  Â  try {
Â  Â  Â  const raw = localStorage.getItem(KEY);
Â  Â  Â  if (!raw) return;
Â  Â  Â  const data = JSON.parse(raw);
Â  Â  Â  Object.entries(data).forEach(([k,v]) => {
Â  Â  Â  Â  const el = document.getElementById(k);
Â  Â  Â  Â  if (!el) return;
Â  Â  Â  Â  if (el.type === 'checkbox') el.checked = !!v;
Â  Â  Â  Â  else if (el.type === 'radio' || el.tagName === 'SELECT') {
Â  Â  Â  Â  Â  if (el.type === 'radio') {
Â  Â  Â  Â  Â  Â  const r = document.querySelector(`[name="${el.name}"][value="${v}"]`);
Â  Â  Â  Â  Â  Â  if (r) r.checked = true;
Â  Â  Â  Â  Â  } else el.value = v;
Â  Â  Â  Â  } else el.value = v;
Â  Â  Â  });
Â  Â  Â  // custom fields
Â  Â  Â  if (data.trusted && Array.isArray(data.trusted)) {
Â  Â  Â  Â  renderTrusted(data.trusted);
Â  Â  Â  }
Â  Â  Â  if (data.avatar) setAvatar(data.avatar);
Â  Â  Â  if (data.stress) { stress.value = data.stress; stressVal.textContent = data.stress; }
Â  Â  } catch(e){ console.warn(e) }
Â  }

Â  function save(data) {
Â  Â  localStorage.setItem(KEY, JSON.stringify(data));
Â  Â  // Also update the separate trusted key (for compatibility with your original code)
Â  Â  saveTrusted(data.trusted || []);
Â  }

Â  function snapshot() {
Â  Â  const topics = Array.from(document.querySelectorAll('input[name="topics"]:checked')).map(i=>i.value);
Â  Â  const coping = Array.from(document.querySelectorAll('input[name="coping"]:checked')).map(i=>i.value);
Â  Â  const moodFreq = (document.querySelector('input[name="moodFreq"]:checked') || {}).value || '';
Â  Â  const journalPrivacy = (document.querySelector('input[name="journalPrivacy"]:checked') || {}).value || '';
Â  Â  const data = {
Â  Â  Â  fullName: document.getElementById('fullName').value || '',
Â  Â  Â  age: document.getElementById('age').value || '',
Â  Â  Â  gender: document.getElementById('gender').value || '',
Â  Â  Â  language: document.getElementById('language').value || '',
Â  Â  Â  affirmTime: document.getElementById('affirmTime').value || '',
Â  Â  Â  topics,
Â  Â  Â  moodFreq,
Â  Â  Â  stress: stress.value,
Â  Â  Â  coping,
Â  Â  Â  journalPrivacy,
Â  Â  Â  saveHistory: document.getElementById('saveHistory').checked,
Â  Â  Â  biometric: document.getElementById('biometric').checked,
Â  Â  Â  anonData: document.getElementById('anonData').checked,
Â  Â  Â  trusted: loadTrusted(), // Loads the trusted list from the separate key
Â  Â  Â  avatar: localStorage.getItem(KEY + '_avatar') || null
Â  Â  };
Â  Â  return data;
Â  }

Â  form.addEventListener('submit', (e) => {
Â  Â  e.preventDefault();
Â  Â  const data = snapshot();
Â  Â  save(data);
Â  Â  alert('Settings saved.');
Â  });

Â  document.getElementById('resetBtn').addEventListener('click', () => {
Â  Â  if (!confirm('Reset settings to defaults?')) return;
Â  Â  localStorage.removeItem(KEY);
Â  Â  localStorage.removeItem(KEY + '_avatar');
    localStorage.removeItem(KEY + '_trusted'); // Ensure trusted key is also reset
Â  Â  location.reload();
Â  });

Â  stress.addEventListener('input', () => stressVal.textContent = stress.value);

Â  // avatar handling (store as dataURL)
Â  avatarInput.addEventListener('change', (e) => {
Â  Â  const f = e.target.files && e.target.files[0];
Â  Â  if (!f) return;
Â  Â  const reader = new FileReader();
Â  Â  reader.onload = () => {
Â  Â  Â  const dataUrl = reader.result;
Â  Â  Â  localStorage.setItem(KEY + '_avatar', dataUrl);
Â  Â  Â  setAvatar(dataUrl);
Â  Â  };
Â  Â  reader.readAsDataURL(f);
Â  });

Â  function setAvatar(dataUrl) {
Â  Â  avatarPreview.innerHTML = '';
Â  Â  const img = document.createElement('img');
Â  Â  img.src = dataUrl;
Â  Â  img.alt = 'Profile photo';
Â  Â  avatarPreview.appendChild(img);
Â  }

Â  // Trusted contacts management (Keep the separate key for backward compatibility)
Â  function loadTrusted() {
Â  Â  try {
Â  Â  Â  const raw = localStorage.getItem(KEY + '_trusted');
Â  Â  Â  return raw ? JSON.parse(raw) : [];
Â  Â  } catch { return []; }
Â  }

Â  function saveTrusted(list) {
Â  Â  localStorage.setItem(KEY + '_trusted', JSON.stringify(list));
Â  }

Â  function renderTrusted(list) {
Â  Â  trustedListEl.innerHTML = '';
Â  Â  list.forEach((t, i) => {
Â  Â  Â  const el = document.createElement('div');
Â  Â  Â  el.className = 'trusted-item';
Â  Â  Â  el.innerHTML = `<div><strong>${escapeHtml(t.name)}</strong><div class="small">${escapeHtml(t.phone)}</div></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex;gap:8px"><a class="small" href="tel:${t.phone}" style="color:var(--accent);text-decoration:none">Call</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button class="btn-ghost" data-i="${i}">Remove</button></div>`;
Â  Â  Â  trustedListEl.appendChild(el);
Â  Â  });
Â  Â  trustedCount.textContent = `${list.length} Contacts Saved`; // ðŸ‘ˆ UPDATED DISPLAY
Â  Â  // attach remove handlers
Â  Â  trustedListEl.querySelectorAll('.btn-ghost').forEach(btn => {
Â  Â  Â  btn.addEventListener('click', (e) => {
Â  Â  Â  Â  const idx = Number(e.currentTarget.dataset.i);
Â  Â  Â  Â  const arr = loadTrusted();
Â  Â  Â  Â  arr.splice(idx,1);
Â  Â  Â  Â  saveTrusted(arr);
Â  Â  Â  Â  renderTrusted(arr);
Â  Â  Â  });
Â  Â  });
Â  }

Â  addTrusted.addEventListener('click', () => {
Â  Â  const name = trustedName.value.trim();
Â  Â  const phone = trustedPhone.value.trim();
Â  Â  if (!name || !phone) return alert('Enter both name and phone number.');
Â  Â  const list = loadTrusted();
Â  Â  list.push({ name, phone });
Â  Â  saveTrusted(list);
Â  Â  trustedName.value = '';
Â  Â  trustedPhone.value = '';
Â  Â  renderTrusted(list);
Â  });

Â  function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

Â  // initialize
Â  (function init() {
Â  Â  // populate radios / selects with defaults if empty
Â  Â  if (!localStorage.getItem(KEY)) {
Â  Â  Â  const defaults = { language:'en', affirmTime:'08:00', stress:5, moodFreq:'', journalPrivacy:'private', trusted:[] };
Â  Â  Â  localStorage.setItem(KEY, JSON.stringify(defaults));
Â  Â  }
Â  Â  // ensure trusted list stored as separate key if absent
Â  Â  if (!localStorage.getItem(KEY + '_trusted')) localStorage.setItem(KEY + '_trusted', JSON.stringify([]));
Â  Â  load();
Â  Â  renderTrusted(loadTrusted());
Â  })();
</script>
</body>
</html>