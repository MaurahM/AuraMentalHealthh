<!DOCTYPE html>
<html lang="en">
<head>
  

<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Meditation â€” Conversational AI</title>
<style>
  :root{
    /* Slightly refined color palette for a calmer feel */
    --bg-dark: #220c1e; /* New, darker background */
    --bg: #3b1534; /* Used for the main wrap/panel */
    --panel: #4e2246; /* Slightly lighter panel for contrast against bg-dark */
    --card-bg: #5a2450; /* Base for card gradient/fill */
    --accent: #ff2fa6;
    --soft: #ffd7f0;
    --muted: #e0d5e2; /* Brighter muted color for text readability */
    --pill: #ffffff;
    --white: #ffffff;
    --shadow-heavy: rgba(0,0,0,0.6);
    --shadow-soft: rgba(0,0,0,0.3);
  }

  html,body{
    height:100%;
    margin:0;
    font-family:'Inter', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background:var(--bg-dark); /* Use the new darker background */
    color:var(--white);
    line-height:1.6;
  }
  .wrap{
    min-height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:32px 16px;
    box-sizing:border-box;
  }
  .panel{
    width:100%;
    max-width:1000px;
    background:var(--panel);
    border-radius:20px;
    padding:32px;
    box-shadow:0 30px 80px var(--shadow-heavy);
    border:1px solid rgba(255,255,255,0.06); /* Clean border */
    box-sizing:border-box;
  }
  .header{
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:20px;
    margin-bottom:30px;
    padding-bottom:10px;
    border-bottom:1px solid rgba(255,255,255,0.1);
  }
  .title{
    font-weight:700;
    font-size:26px; /* Larger title */
    letter-spacing:0.5px;
  }
  .subtitle{
    color:var(--muted);
    font-size:15px;
    opacity:0.9;
  }
  .grid{
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(250px,1fr)); /* Better responsive grid */
    gap:24px;
    margin-top:24px;
  }
  .card{
    background:linear-gradient(145deg, rgba(255,255,255,0.02), rgba(0,0,0,0.05));
    border-radius:18px;
    padding:24px;
    display:flex;
    flex-direction:column;
    align-items:center;
    gap:16px;
    min-height:160px;
    justify-content:center;
    box-shadow:0 8px 24px var(--shadow-soft);
    border:1px solid rgba(255,255,255,0.1);
    cursor:pointer;
    transition:transform .18s ease, box-shadow .18s ease, border-color .18s ease;
    text-align:center;
    outline:none;
  }
  .card:hover{
    transform:translateY(-4px); /* Softer lift */
    box-shadow:0 15px 40px var(--shadow-heavy);
    border-color:var(--accent); /* Highlight on hover */
  }
  .card:focus-visible{
    outline:3px solid var(--soft);
    outline-offset: 4px;
  }
  .cute-badge{
    width:70px; /* Slightly smaller badge */
    height:70px;
    border-radius:50%; /* Make it round */
    display:flex;
    align-items:center;
    justify-content:center;
    background:var(--pill);
    box-shadow:0 6px 15px var(--shadow-soft);
  }
  .badge-ico{
    width:36px;
    height:36px;
    fill:var(--accent);
  }
  .card h3{
    margin:0;
    font-size:18px; /* Slightly larger heading */
    color:var(--white);
    font-weight:600;
    letter-spacing:0.2px;
  }
  .card p{
    margin:0;
    font-size:14px;
    color:var(--muted);
    text-align:center;
  }
  .actions{display:flex;gap:12px;align-items:center;justify-content:center;margin-top:24px}
  .btn{
    background:var(--accent); /* Solid accent color */
    color:#fff;
    border:0;
    padding:12px 24px;
    border-radius:999px;
    font-weight:600;
    cursor:pointer;
    box-shadow:0 4px 12px rgba(255,47,166,0.4);
    transition:transform .15s ease, opacity .15s ease;
  }
  .btn:hover{
    opacity:0.9;
    transform:translateY(-1px);
  }
  .btn-ghost{
    background:rgba(255,255,255,0.06);
    border:1px solid rgba(255,255,255,0.15);
    color:var(--muted);
    padding:10px 16px;
    border-radius:10px;
    cursor:pointer;
    transition:background .15s ease, border-color .15s ease;
    
  }
  .btn-ghost:hover{
    background:rgba(255,255,255,0.1);
    border-color:var(--white);
  }
  .note{
    color:var(--muted);
    text-align:center;
    margin-top:20px;
    font-size:14px;
  }

  /* modal */
  .backdrop{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.7); /* Darker backdrop */
    display:none;
    align-items:center;
    justify-content:center;
    z-index:1000;
    padding:16px;
  }
  .modal{
    background:var(--bg-dark); /* Contrast with panel */
    padding:24px;
    border-radius:16px;
    max-width:650px;
    width:100%;
    box-shadow:0 40px 100px var(--shadow-heavy);
    color:var(--white);
    max-height:90vh;
    overflow-y:auto;
    border:1px solid var(--accent);
  }
  .modal h2{
    margin:0 0 4px;
    font-size:22px;
    font-weight:700;
  }
  .meta{
    color:var(--accent);
    font-size:14px;
    margin-bottom:16px;
    font-weight:500;
  }
  .controls{display:flex;gap:10px;align-items:center}
  .timer{
    font-weight:800;
    font-size:36px; /* Larger timer */
    padding:16px 24px;
    border-radius:12px;
    background:rgba(255,255,255,0.08);
    display:inline-block;
    min-width:140px;
    text-align:center;
    box-shadow:0 0 15px rgba(255,47,166,0.2); /* Soft glow */
    color:var(--soft);
  }
  .presets{display:flex;gap:10px;flex-wrap:wrap;margin-top:15px}
  .preset{
    background:rgba(255,255,255,0.05);
    color:var(--muted);
    padding:8px 14px;
    border-radius:20px;
    border:1px solid rgba(255,255,255,0.1);
    cursor:pointer;
    font-size:14px;
    transition:background .15s ease, border-color .15s ease;
  }
  .preset:hover{
    background:rgba(255,255,255,0.15);
    border-color:var(--soft);
  }
  .guide{
    background:rgba(255,255,255,0.02);
    padding:20px;
    border-radius:12px;
    margin-top:20px;
    color:var(--muted);
    line-height:1.7;
    font-size:16px;
  }
  .cute-note{
    background:var(--soft);
    color:#222;
    padding:12px;
    border-radius:12px;
    margin-top:20px;
    font-weight:700;
    text-align:center;
    font-size:15px;
  }

  @media (max-width:980px){
    .panel{padding:24px;border-radius:16px;}
    .grid{grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:18px;}
  }
  @media (max-width:640px){
    .wrap{padding:16px;}
    .grid{grid-template-columns:1fr; gap:16px;}
    .header{flex-direction:column;align-items:flex-start}
    .actions{align-self:flex-end;margin-top:0;margin-bottom:10px;}
    .modal h2{font-size:20px;}
    .timer{font-size:30px;min-width:120px;}
    .modal > div:first-child{flex-direction:column; align-items:flex-start;}
    .modal > div:first-child > div:last-child{align-self:flex-end;}
  }
</style>
<script src="theme-manager.js"></script>
</head>
<body>
    <script>
    // --- ðŸ”‘ AUTHENTICATION GUARD SCRIPT (MUST RUN FIRST) ---
    const TOKEN_KEY = 'convai_user_token';
    const token = localStorage.getItem(TOKEN_KEY);

    // If the token is missing (meaning the user logged out), redirect immediately.
    if (!token) {
        window.location.href = 'index.html';
    }
    // --- END GUARD SCRIPT ---
</script>
  <main class="wrap" role="main" aria-labelledby="medTitle">
    <section class="panel" aria-labelledby="medTitle">
      <div class="header">
        <div>
          <div id="medTitle" class="title">Meditation Practices</div>
          <div class="subtitle">Small, cute practices to calm attention and boost wellbeing. Pick a practice to view guidance and start a timer.</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <a href="Dashboard.html" class="btn-ghost">Back</a>
          
        </div>
      </div>

      <div class="grid" id="practices" role="list">
        <!-- practice cards inserted by JS -->
      </div>

      <div class="note">Tip: use presets in the session modal to quickly choose a length. A gentle bell will play at start and end.</div>
    </section>
  </main>

  <div id="backdrop" class="backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="modalTitle">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div>
          <h2 id="modalTitle">Practice</h2>
          <div id="modalSub" class="meta">Guide</div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
          <div class="timer" id="timer">05:00</div>
          <div class="controls" role="group" aria-label="Timer controls">
            <button id="startBtn" class="btn">Start</button>
            <button id="pauseBtn" class="btn-ghost">Pause</button>
            <button id="resetBtn" class="btn-ghost">Reset</button>
          </div>
        </div>
      </div>

      <div class="presets" aria-hidden="false">
        <button class="preset" data-secs="180">3 min</button>
        <button class="preset" data-secs="300">5 min</button>
        <button class="preset" data-secs="600">10 min</button>
        <button class="preset" data-secs="900">15 min</button>
      </div>

      <div id="guide" class="guide" tabindex="0"></div>

      <div class="cute-note" id="cuteNote" aria-hidden="true">You're doing great â€” just breathe.</div>

      <div style="display:flex;justify-content:flex-end;margin-top:12px">
        <button id="closeModal" class="btn-ghost">Close</button>
      </div>
    </div>
  </div>

<script>
  // practice definitions
  const PRACTICES = [
    {
      id: 'breath',
      title: 'Breath Awareness',
      short: 'Follow the natural rhythm of breathing.',
      guide: `Find a comfortable position. Gently bring attention to the breath at the nostrils or chest.
Notice inhale and exhale without changing them. If the mind wanders, kindly return to the breath.`
    },
    {
      id: 'body',
      title: 'Body Scan',
      short: 'Progressively relax the body from toes to head.',
      guide: `Lie or sit comfortably. Slowly move attention through the body â€” toes, feet, legs, hips, torso, arms, neck, head.
Notice sensations without needing to change them. Breathe gently as you scan.`
    },
    {
      id: 'loving',
      title: 'Loving-Kindness',
      short: 'Send warm wishes to yourself and others.',
      guide: `Silently repeat short phrases such as "May I be safe. May I be happy. May I be healthy."
After a few minutes, extend the same wishes to someone you care about, then to someone neutral, then to all beings.`
    },
    {
      id: 'visual',
      title: 'Guided Visualization',
      short: 'Use imagery to relax (beach, forest, safe place).',
      guide: `Create a calming scene in your mind â€” a quiet beach, a warm forest, or a safe room.
Engage the senses: notice colors, sounds, textures, and the feeling of safety. Stay there for a few moments.`
    },
    {
      id: 'box',
      title: 'Box Breathing',
      short: '4-4-4-4 rhythmic breathing to stabilize the nervous system.',
      guide: `Inhale slowly to a count of 4. Hold the breath for 4. Exhale for 4. Hold the empty breath for 4.
Repeat for several cycles. Adjust counts if needed.`
    },
    {
      id: 'mindful',
      title: 'Mindful Walking',
      short: 'Use slow steps to anchor the mind in the body.',
      guide: `Walk slowly and notice each step. Feel your feet lifting and touching the ground.
Be aware of balance, movement, and surrounding sensations. Keep attention on walking rhythm.`
    }
  ];

  const practicesEl = document.getElementById('practices');
  const backdrop = document.getElementById('backdrop');
  const modalTitle = document.getElementById('modalTitle');
  const modalSub = document.getElementById('modalSub');
  const guideEl = document.getElementById('guide');
  const timerEl = document.getElementById('timer');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  const presets = document.querySelectorAll('.preset');
  const closeModal = document.getElementById('closeModal');
  const cuteNote = document.getElementById('cuteNote');

  let current = null;
  let totalSecs = 300;
  let remaining = totalSecs;
  let interval = null;
  let audioCtx = null;

  function buildCards(){
    PRACTICES.forEach(p => {
      const btn = document.createElement('button');
      btn.className = 'card';
      btn.setAttribute('role','button');
      btn.tabIndex = 0;
      btn.innerHTML = `
        <div class="cute-badge" aria-hidden="true">
          <svg class="badge-ico" viewBox="0 0 24 24" xmlns="https://www.w3.org/2000/svg">
            <path d="${iconPathFor(p.id)}"/>
          </svg>
        </div>
        <h3>${p.title}</h3>
        <p>${p.short}</p>
      `;
      btn.addEventListener('click', () => openPractice(p));
      btn.addEventListener('keydown', (e) => { if (e.key==='Enter' || e.key===' ') { e.preventDefault(); openPractice(p); }});
      practicesEl.appendChild(btn);
    });
  }

  // small set of simple SVG path variations for cuteness
  function iconPathFor(id){
    switch(id){
      case 'breath': return 'M3 12c2-6 10-6 12 0 2 6 10 6 12 0';
      case 'body': return 'M12 2a4 4 0 1 0 0 8 4 4 0 0 0 0-8z M4 20c2-4 14-4 16 0';
      case 'loving': return 'M12 21s-8-5.2-8-9.5C4 7 7 4 12 7c5-3 8 0 8 4.5S12 21 12 21z';
      case 'visual': return 'M2 12h20M6 8l4 4 4-4 4 4';
      case 'box': return 'M4 4h16v16H4z';
      case 'mindful': return 'M10 21c-2 0-3-1-3-3v-4h3m0 0h5m-5 0c0-2-3-3-3-5s3-3 3-5h5c0 2 3 3 3 5s-3 3-3 5h-5z';
      default: return 'M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z';
    }
  }

  function openPractice(p){
    current = p;
    modalTitle.textContent = p.title;
    modalSub.textContent = p.short;
    guideEl.textContent = p.guide;
    // default time per practice
    totalSecs = ({breath:300, body:600, loving:420, visual:420, box:300, mindful:300}[p.id]) || 300;
    remaining = totalSecs;
    renderTimer();
    showModal();
  }

  function showModal(){
    backdrop.style.display = 'flex';
    backdrop.setAttribute('aria-hidden','false');
    pause(); // ensure cleared
    cuteNote.setAttribute('aria-hidden','true');
    startBtn.focus();
  }

  function close(){
    backdrop.style.display = 'none';
    backdrop.setAttribute('aria-hidden','true');
    pause();
  }

  function renderTimer(){
    const mm = String(Math.floor(remaining/60)).padStart(2,'0');
    const ss = String(remaining%60).padStart(2,'0');
    timerEl.textContent = `${mm}:${ss}`;
  }

  function start(){
    if (!audioCtx) initAudio();
    playBell(0.15, 'start');
    if (interval) return;
    interval = setInterval(() => {
      if (remaining <= 0) {
        finish();
        return;
      }
      remaining--;
      renderTimer();
      // small gentle prompt near the end
      if (remaining === 10) playBell(0.06,'tiny');
    }, 1000);
    startBtn.disabled = true;
    pauseBtn.disabled = false;
    resetBtn.disabled = false;
  }

  function pause(){
    if (interval) clearInterval(interval);
    interval = null;
    startBtn.disabled = false;
    pauseBtn.disabled = true;
  }

  function reset(){
    remaining = totalSecs;
    renderTimer();
    pause();
  }

  function finish(){
    pause();
    remaining = 0;
    renderTimer();
    playBell(0.35,'end');
    cuteNote.setAttribute('aria-hidden','false');
  }

  // presets handler
  presets.forEach(p => {
    p.addEventListener('click', () => {
      totalSecs = Number(p.dataset.secs) || totalSecs;
      remaining = totalSecs;
      renderTimer();
    });
  });

  startBtn.addEventListener('click', start);
  pauseBtn.addEventListener('click', pause);
  resetBtn.addEventListener('click', reset);
  closeModal.addEventListener('click', close);
  backdrop.addEventListener('click', (e) => { if (e.target === backdrop) close(); });
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && backdrop.style.display === 'flex') close(); });

  // audio helper: simple bell using WebAudio
  function initAudio(){
    try {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    } catch(e){ audioCtx = null; }
  }

  function playBell(duration = 0.2, type = 'bell'){
    if (!audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.connect(g); g.connect(audioCtx.destination);
    if (type === 'start') o.frequency.value = 880;
    else if (type === 'tiny') o.frequency.value = 1200;
    else if (type === 'end') o.frequency.value = 520;
    else o.frequency.value = 660;
    g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.08, audioCtx.currentTime + 0.02);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
    o.stop(audioCtx.currentTime + duration + 0.02);
  }

  // initial build
  buildCards();

  // small accessibility: focus first preset on open
  const observer = new MutationObserver(() => {
    if (backdrop.style.display === 'flex') {
      const p0 = document.querySelector('.preset');
      if (p0) p0.focus();
      observer.disconnect();
    }
  });

  // ensure initial control states
  pauseBtn.disabled = true;
  resetBtn.disabled = true;

  // expose tiny restore: if page loaded with a practice id in hash, open
  window.addEventListener('load', () => {
    const hash = (location.hash || '').replace('#','');
    if (hash) {
      const p = PRACTICES.find(x => x.id === hash);
      if (p) openPractice(p);
    }
  });
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Meditation </title>
<style>
  :root{
    --bg:#3b1534;
    --panel:#5a2450;
    --card:#6f3b64;
    --accent:#ff2fa6;
    --soft:#ffd7f0;
    --muted:#d9c9dc;
    --pill:#ffffff;
    --white:#ffffff;
  }

  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:var(--bg);color:var(--white)}
  .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:28px;box-sizing:border-box}
  .panel{width:100%;max-width:1100px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));border-radius:14px;padding:28px;box-shadow:0 30px 80px rgba(0,0,0,0.45);box-sizing:border-box}
  .header{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:18px}
  .title{font-weight:800;font-size:20px;letter-spacing:0.6px}
  .subtitle{color:var(--muted);font-size:13px}
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:18px;margin-top:18px}
  .card{
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.02));
    border-radius:16px;padding:20px;display:flex;flex-direction:column;align-items:center;gap:12px;min-height:140px;justify-content:center;
    box-shadow:inset 0 1px 0 rgba(255,255,255,0.03), 0 8px 28px rgba(0,0,0,0.35);
    border:1px solid rgba(255,255,255,0.06);cursor:pointer;transition:transform .14s ease,box-shadow .14s ease;
  }
  .card:hover{transform:translateY(-6px);box-shadow:0 22px 48px rgba(0,0,0,0.45)}
  .cute-badge{width:88px;height:88px;border-radius:18px;display:flex;align-items:center;justify-content:center;background:var(--pill);box-shadow:0 8px 20px rgba(0,0,0,0.18)}
  .badge-ico{width:44px;height:44px;fill:var(--accent)}
  .card h3{margin:0;font-size:16px;color:var(--muted);font-weight:700}
  .card p{margin:0;font-size:13px;color:rgba(255,255,255,0.9);text-align:center}
  .actions{display:flex;gap:10px;align-items:center;justify-content:center;margin-top:18px}
  .btn{background:linear-gradient(90deg,var(--accent),#ff5aa8);color:#fff;border:0;padding:10px 14px;border-radius:999px;font-weight:700;cursor:pointer}
  .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 12px;border-radius:8px;cursor:pointer}
  .note{color:var(--muted);text-align:center;margin-top:12px;font-size:13px}

  /* modal */
  .backdrop{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:none;align-items:center;justify-content:center;z-index:60;padding:18px}
  .modal{background:var(--panel);padding:18px;border-radius:12px;max-width:720px;width:100%;box-shadow:0 30px 80px rgba(0,0,0,0.6);color:var(--white);max-height:90vh;overflow:auto}
  .modal h2{margin:0 0 8px}
  .meta{color:var(--muted);font-size:13px;margin-bottom:12px}
  .controls{display:flex;gap:8px;align-items:center}
  .timer{font-weight:800;font-size:28px;padding:12px 18px;border-radius:999px;background:rgba(255,255,255,0.03);display:inline-block;min-width:120px;text-align:center}
  .presets{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
  .preset{background:rgba(255,255,255,0.03);color:var(--muted);padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,0.02);cursor:pointer}
  .preset:hover{background:rgba(255,255,255,0.04)}
  .guide{background:rgba(255,255,255,0.02);padding:12px;border-radius:10px;margin-top:12px;color:var(--muted);line-height:1.5}
  .cute-note{background:var(--pill);color:#222;padding:10px;border-radius:10px;margin-top:12px;font-weight:700;text-align:center}

  @media (max-width:980px){
    .grid{grid-template-columns:repeat(2,1fr)}
  }
  @media (max-width:640px){
    .grid{grid-template-columns:1fr}
    .header{flex-direction:column;align-items:flex-start}
  }
</style>
</head>
<body>


  <div id="backdrop" class="backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document" aria-labelledby="modalTitle">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap">
        <div>
          <h2 id="modalTitle">Practice</h2>
          <div id="modalSub" class="meta">Guide</div>
        </div>
        <div style="display:flex;flex-direction:column;align-items:flex-end;gap:8px">
          <div class="timer" id="timer">05:00</div>
          <div class="controls" role="group" aria-label="Timer controls">
            <button id="startBtn" class="btn">Start</button>
            <button id="pauseBtn" class="btn-ghost">Pause</button>
            <button id="resetBtn" class="btn-ghost">Reset</button>
          </div>
        </div>
      </div>

      <div class="presets" aria-hidden="false">
        <button class="preset" data-secs="180">3 min</button>
        <button class="preset" data-secs="300">5 min</button>
        <button class="preset" data-secs="600">10 min</button>
        <button class="preset" data-secs="900">15 min</button>
      </div>

      <div id="guide" class="guide" tabindex="0"></div>

      <div class="cute-note" id="cuteNote" aria-hidden="true">You're doing great â€” just breathe.</div>

      <div style="display:flex;justify-content:flex-end;margin-top:12px">
        <button id="closeModal" class="btn-ghost">Close</button>
      </div>
    </div>
  </div>

<script>
  // practice definitions
  const PRACTICES = [
    {
      id: 'breath',
      title: 'Breath Awareness',
      short: 'Follow the natural rhythm of breathing.',
      guide: `Find a comfortable position. Gently bring attention to the breath at the nostrils or chest.
Notice inhale and exhale without changing them. If the mind wanders, kindly return to the breath.`
    },
    {
      id: 'body',
      title: 'Body Scan',
      short: 'Progressively relax the body from toes to head.',
      guide: `Lie or sit comfortably. Slowly move attention through the body â€” toes, feet, legs, hips, torso, arms, neck, head.
Notice sensations without needing to change them. Breathe gently as you scan.`
    },
    {
      id: 'loving',
      title: 'Loving-Kindness',
      short: 'Send warm wishes to yourself and others.',
      guide: `Silently repeat short phrases such as "May I be safe. May I be happy. May I be healthy."
After a few minutes, extend the same wishes to someone you care about, then to someone neutral, then to all beings.`
    },
    {
      id: 'visual',
      title: 'Guided Visualization',
      short: 'Use imagery to relax (beach, forest, safe place).',
      guide: `Create a calming scene in your mind â€” a quiet beach, a warm forest, or a safe room.
Engage the senses: notice colors, sounds, textures, and the feeling of safety. Stay there for a few moments.`
    },
    {
      id: 'box',
      title: 'Box Breathing',
      short: '4-4-4-4 rhythmic breathing to stabilize the nervous system.',
      guide: `Inhale slowly to a count of 4. Hold the breath for 4. Exhale for 4. Hold the empty breath for 4.
Repeat for several cycles. Adjust counts if needed.`
    },
    {
      id: 'mindful',
      title: 'Mindful Walking',
      short: 'Use slow steps to anchor the mind in the body.',
      guide: `Walk slowly and notice each step. Feel your feet lifting and touching the ground.
Be aware of balance, movement, and surrounding sensations. Keep attention on walking rhythm.`
    }
  ];

  const practicesEl = document.getElementById('practices');
  const backdrop = document.getElementById('backdrop');
  const modalTitle = document.getElementById('modalTitle');
  const modalSub = document.getElementById('modalSub');
  const guideEl = document.getElementById('guide');
  const timerEl = document.getElementById('timer');
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  const presets = document.querySelectorAll('.preset');
  const closeModal = document.getElementById('closeModal');
  const cuteNote = document.getElementById('cuteNote');

  let current = null;
  let totalSecs = 300;
  let remaining = totalSecs;
  let interval = null;
  let audioCtx = null;

  function buildCards(){
    PRACTICES.forEach(p => {
      const btn = document.createElement('button');
      btn.className = 'card';
      btn.setAttribute('role','button');
      btn.tabIndex = 0;
      btn.innerHTML = `
        <div class="cute-badge" aria-hidden="true">
          <svg class="badge-ico" viewBox="0 0 24 24" xmlns="https://www.w3.org/2000/svg">
            <path d="${iconPathFor(p.id)}"/>
          </svg>
        </div>
        <h3>${p.title}</h3>
        <p>${p.short}</p>
      `;
      btn.addEventListener('click', () => openPractice(p));
      btn.addEventListener('keydown', (e) => { if (e.key==='Enter' || e.key===' ') { e.preventDefault(); openPractice(p); }});
      practicesEl.appendChild(btn);
    });
  }

  // small set of simple SVG path variations for cuteness
  function iconPathFor(id){
    switch(id){
      case 'breath': return 'M3 12c2-6 10-6 12 0 2 6 10 6 12 0';
      case 'body': return 'M12 2a4 4 0 1 0 0 8 4 4 0 0 0 0-8z M4 20c2-4 14-4 16 0';
      case 'loving': return 'M12 21s-8-5.2-8-9.5C4 7 7 4 12 7c5-3 8 0 8 4.5S12 21 12 21z';
      case 'visual': return 'M2 12h20M6 8l4 4 4-4 4 4';
      case 'box': return 'M4 4h16v16H4z';
      case 'mindful': return 'M10 21c-2 0-3-1-3-3v-4h3m0 0h5m-5 0c0-2-3-3-3-5s3-3 3-5h5c0 2 3 3 3 5s-3 3-3 5h-5z';
      default: return 'M12 2a10 10 0 1 0 0 20 10 10 0 0 0 0-20z';
    }
  }

  function openPractice(p){
    current = p;
    modalTitle.textContent = p.title;
    modalSub.textContent = p.short;
    guideEl.textContent = p.guide;
    // default time per practice
    totalSecs = ({breath:300, body:600, loving:420, visual:420, box:300, mindful:300}[p.id]) || 300;
    remaining = totalSecs;
    renderTimer();
    showModal();
  }

  function showModal(){
    backdrop.style.display = 'flex';
    backdrop.setAttribute('aria-hidden','false');
    pause(); // ensure cleared
    cuteNote.setAttribute('aria-hidden','true');
    startBtn.focus();
  }

  function close(){
    backdrop.style.display = 'none';
    backdrop.setAttribute('aria-hidden','true');
    pause();
  }

  function renderTimer(){
    const mm = String(Math.floor(remaining/60)).padStart(2,'0');
    const ss = String(remaining%60).padStart(2,'0');
    timerEl.textContent = `${mm}:${ss}`;
  }

  function start(){
    if (!audioCtx) initAudio();
    playBell(0.15, 'start');
    if (interval) return;
    interval = setInterval(() => {
      if (remaining <= 0) {
        finish();
        return;
      }
      remaining--;
      renderTimer();
      // small gentle prompt near the end
      if (remaining === 10) playBell(0.06,'tiny');
    }, 1000);
    startBtn.disabled = true;
    pauseBtn.disabled = false;
    resetBtn.disabled = false;
  }

  function pause(){
    if (interval) clearInterval(interval);
    interval = null;
    startBtn.disabled = false;
    pauseBtn.disabled = true;
  }

  function reset(){
    remaining = totalSecs;
    renderTimer();
    pause();
  }

  function finish(){
    pause();
    remaining = 0;
    renderTimer();
    playBell(0.35,'end');
    cuteNote.setAttribute('aria-hidden','false');
  }

  // presets handler
  presets.forEach(p => {
    p.addEventListener('click', () => {
      totalSecs = Number(p.dataset.secs) || totalSecs;
      remaining = totalSecs;
      renderTimer();
    });
  });

  startBtn.addEventListener('click', start);
  pauseBtn.addEventListener('click', pause);
  resetBtn.addEventListener('click', reset);
  closeModal.addEventListener('click', close);
  backdrop.addEventListener('click', (e) => { if (e.target === backdrop) close(); });
  document.addEventListener('keydown', (e) => { if (e.key === 'Escape' && backdrop.style.display === 'flex') close(); });

  // audio helper: simple bell using WebAudio
  function initAudio(){
    try {
      audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    } catch(e){ audioCtx = null; }
  }

  function playBell(duration = 0.2, type = 'bell'){
    if (!audioCtx) return;
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.connect(g); g.connect(audioCtx.destination);
    if (type === 'start') o.frequency.value = 880;
    else if (type === 'tiny') o.frequency.value = 1200;
    else if (type === 'end') o.frequency.value = 520;
    else o.frequency.value = 660;
    g.gain.setValueAtTime(0.0001, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.08, audioCtx.currentTime + 0.02);
    o.start();
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
    o.stop(audioCtx.currentTime + duration + 0.02);
  }

  // initial build
  buildCards();

  // small accessibility: focus first preset on open
  const observer = new MutationObserver(() => {
    if (backdrop.style.display === 'flex') {
      const p0 = document.querySelector('.preset');
      if (p0) p0.focus();
      observer.disconnect();
    }
  });

  // ensure initial control states
  pauseBtn.disabled = true;
  resetBtn.disabled = true;

  // expose tiny restore: if page loaded with a practice id in hash, open
  window.addEventListener('load', () => {
    const hash = (location.hash || '').replace('#','');
    if (hash) {
      const p = PRACTICES.find(x => x.id === hash);
      if (p) openPractice(p);
    }
  });
</script>
</body>
</html>