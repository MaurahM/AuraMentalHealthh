<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Create New Password | Conversational AI</title>
<style>
  :root{
    --bg:#3b1534; 
    --accent:#ff2fa6; 
    --muted:#d9c9dc;
    --white: #ffffff;
    --dark-input: rgba(0, 0, 0, 0.2);
  }
  
  html,body{height:100%;margin:0;font-family:Inter,system-ui,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--white)}
  .wrap{min-height:100%;display:flex;align-items:center;justify-content:center;padding:48px;box-sizing:border-box}
  
  .card{
    width:100%;max-width:920px;
    background:linear-gradient(180deg, rgba(255,255,255,0.03), rgba(0,0,0,0.03));
    border-radius:12px;
    padding:40px;
    box-shadow: 0 40px 80px rgba(0, 0, 0, 0.7), 0 0 100px rgba(255, 47, 166, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.05);
    backdrop-filter: blur(8px);
    display:flex;gap:28px;align-items:center;box-sizing:border-box
  }

  .left,.right{flex:1;min-width:0}

  .left{padding:18px 28px;border-right:2px solid rgba(255,255,255,0.08);display:flex;flex-direction:column;align-items:center;gap:18px}
  .illustration{
    width:160px;height:160px;border-radius:999px;display:flex;align-items:center;justify-content:center;
    border:3px solid rgba(255,255,255,0.12);
    box-shadow: 0 0 40px rgba(255, 47, 166, 0.15); 
  }

  .headline{font-weight:700;font-size:24px;letter-spacing:1px;line-height:1.2;text-align:center}
  .lead{color:var(--muted);max-width:320px;line-height:1.6;font-size:15px;text-align:center}

  .form-wrap{display:flex;flex-direction:column;align-items:center;padding:8px 12px}
  .form-card{width:100%;max-width:420px}
  h1{margin:6px 0 12px;font-size:30px;text-align:center;font-weight:800;}
  form{display:flex;flex-direction:column;gap:16px}
  label{display:block;font-size:14px;margin-bottom:6px;color:rgba(255,255,255,0.9);font-weight:600;}
  
  .pill{
    display:block;width:100%;padding:14px 20px;
    border-radius:999px;border:1px solid rgba(255, 255, 255, 0.1);
    background:var(--dark-input);
    box-sizing:border-box;font-size:15px;color:var(--white);
    outline:none;
    box-shadow:inset 0 1px 3px rgba(0,0,0,0.4);
    transition: all 0.2s;
  }
  .pill:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(255, 47, 166, 0.3); }

  .btn{
    width:100%; max-width:280px;
    background:linear-gradient(90deg,#ff2fa6,#ff5aa8);color:#fff;border:0;
    padding:14px 24px;border-radius:999px;font-weight:700;cursor:pointer;
    box-shadow:0 10px 30px rgba(255,47,166,0.3);
    transition: all 0.2s ease;
    margin: 10px auto 0;
  }
  .btn:hover{ transform: translateY(-1px); box-shadow:0 12px 35px rgba(255,47,166,0.5); }
  .btn:disabled{ opacity: 0.6; cursor: not-allowed; }

  .error{color:#ffb3c6;font-size:13px;min-height:18px;text-align:center;margin-top:8px}
  .success-msg { display: none; text-align: center; color: #a3ffca; background: rgba(163, 255, 202, 0.1); padding: 15px; border-radius: 12px; border: 1px solid rgba(163, 255, 202, 0.2); }

  @media (max-width:880px){
    .card{flex-direction:column;padding:20px}
    .left{order:2;border-right:0;border-top:1px solid rgba(255,255,255,0.04);padding-top:18px}
    .right{order:1}
  }
</style>
</head>
<body>
  <main class="wrap">
    <section class="card">
      <div class="left">
        <div class="illustration">
          <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
            <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
          </svg>
        </div>
        <div>
          <div class="headline">NEW BEGINNING</div>
          <p class="lead">Set a strong, new password to keep your conversations safe and private.</p>
        </div>
      </div>

      <div class="right">
        <div class="form-wrap">
          <div class="form-card">
            <h1>New Password</h1>
            
            <div id="successBox" class="success-msg">
                Password updated successfully! You can now log in with your new credentials.
                <br><br>
                <a href="Login.html" style="color:#a3ffca; font-weight:700;">Go to Login</a>
            </div>

            <form id="resetForm" novalidate>
              <div>
                <label for="password">New Password</label>
                <input id="password" type="password" class="pill" placeholder="Min. 8 characters" required />
              </div>
              
              <div>
                <label for="confirmPassword">Confirm Password</label>
                <input id="confirmPassword" type="password" class="pill" placeholder="Repeat password" required />
              </div>

              <div style="display:flex;flex-direction: column;align-items:center;">
                <span id="feedback" class="error" aria-live="polite"></span>
                <button id="submitBtn" class="btn" type="submit">Update Password</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </section>
  </main>

<script>
const API_URL = 'https://auramentalhealthh-production.up.railway.app';
const form = document.getElementById('resetForm');
const feedback = document.getElementById('feedback');
const submitBtn = document.getElementById('submitBtn');
const successBox = document.getElementById('successBox');

// 1. Get the token from the URL (e.g., ?token=xyz)
const urlParams = new URLSearchParams(window.location.search);
const token = urlParams.get('token');

// If no token, warn the user
if (!token) {
  feedback.textContent = 'Invalid or missing reset token.';
  submitBtn.disabled = true;
}

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  feedback.textContent = '';

  const newPass = document.getElementById('password').value;
  const confirmPass = document.getElementById('confirmPassword').value;

  if (newPass.length < 8) {
    feedback.textContent = 'Password must be at least 8 characters.';
    return;
  }
  if (newPass !== confirmPass) {
    feedback.textContent = 'Passwords do not match.';
    return;
  }

  submitBtn.disabled = true;
  submitBtn.textContent = 'Updating...';

  try {
    const res = await fetch(`${API_URL}/api/auth/reset-password`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ 
        token: token,
        password: newPass 
      })
    });

    if (res.ok) {
      form.style.display = 'none';
      successBox.style.display = 'block';
      document.querySelector('h1').textContent = 'All Set!';
    } else {
      const data = await res.json();
      feedback.textContent = data.message || 'Link expired or invalid.';
    }
  } catch (err) {
    feedback.textContent = 'Network error. Try again later.';
  } finally {
    submitBtn.disabled = false;
    submitBtn.textContent = 'Update Password';
  }
});
</script>
</body>
</html>